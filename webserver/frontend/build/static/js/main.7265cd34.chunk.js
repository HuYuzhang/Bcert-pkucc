(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{246:function(e){e.exports=[{id:"jasmin3q.id.blockstack",name:"Jasmine"},{id:"alice.id.blockstack",name:"Alice"}]},247:function(e,t,a){e.exports=a(551)},252:function(e,t,a){},253:function(e,t,a){},266:function(e,t){},268:function(e,t){},284:function(e,t){},287:function(e,t){},456:function(e,t){},525:function(e,t,a){},544:function(e,t,a){},545:function(e,t,a){},546:function(e,t,a){},547:function(e,t,a){},548:function(e,t,a){},551:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(244),i=a.n(s),c=a(555),l=(a(252),a(18)),o=a(19),u=a(21),m=a(20),d=a(22),p=(a(253),a(37)),v=a(14),h=a(553),f=new p.AppConfig(["store_write","publish_data"]),b=[{id:"cat",name:"Cat",superpower:"Has 9 lives."},{id:"dog",name:"Dog",superpower:"Catching frisbees."},{id:"lion",name:"Lion",superpower:"Roaring loudly."},{id:"PKU_2020_Graduates",name:"PKU_2020_Graduates",superpower:"Graduate."}],g=[{id:"forest",name:"Forest",superpower:"Trees!"},{id:"tundra",name:"Tundra",superpower:"Let it snow!"},{id:"westeros",name:"Westeros",superpower:"The Iron Throne!"}],E="me.json",j="subjects.json",k=(a(525),a(245)),y=a.n(k),N=function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(u.a)(this,Object(m.a)(t).call(this))).txtChanged=function(t){var a=t.target.value;e.setState({url:a})},e.userSession=new p.UserSession({appConfig:f}),e.state={url:" "},e.handleClick=e.handleClick.bind(Object(v.a)(e)),e}return Object(d.a)(t,e),Object(o.a)(t,[{key:"handleClick",value:function(){console.log("start to redirect to verify");var e="http://127.0.0.1:8080/verify?url="+this.state.url;y.a.get(e).then(function(e){var t=e.data;alert(t)}).catch(function(e){console.log(e)})}},{key:"signIn",value:function(e){e.preventDefault(),this.userSession.redirectToSignIn()}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement("nav",{className:"navbar navbar-expand-md navbar-dark bg-blue fixed-top"},r.a.createElement(h.a,{className:"navbar-brand",to:"/"},"PKU Cert Centre"),r.a.createElement("div",{className:"collapse navbar-collapse",id:"navbarsExampleDefault"},r.a.createElement("ul",{className:"navbar-nav mr-auto"},r.a.createElement("li",{className:"nav-item"},r.a.createElement(h.a,{className:"nav-link",to:"/"},"\u7f51\u7ad9\u9996\u9875")),r.a.createElement("li",{className:"nav-item"},r.a.createElement(h.a,{className:"nav-link",to:"/"},"\u9a8c\u8bc1\u8bc1\u4e66")),r.a.createElement("li",{className:"nav-item"},r.a.createElement(h.a,{className:"nav-link",to:"/",onClick:this.signIn.bind(this)},"\u4e2a\u4eba\u4e3b\u9875")),r.a.createElement("li",{className:"nav-item"},r.a.createElement(h.a,{className:"nav-link",to:"/"},"\u5173\u4e8e\u6211\u4eec"))))),r.a.createElement("div",{className:"banner"},r.a.createElement("div",{className:"search"},r.a.createElement("div",{className:"first"},r.a.createElement("span",{className:"pas"},"\u8f93\u5165\u9700\u8981\u9a8c\u8bc1\u7684\u8bc1\u4e66URL")),r.a.createElement("div",{className:"second"},r.a.createElement("div",{className:"back"},r.a.createElement("input",{type:"text",name:"id",value:this.state.url,onChange:function(t){return e.txtChanged(t)},className:"number"}),r.a.createElement("input",{type:"submit",onClick:this.handleClick,value:"\u9a8c\u8bc1",className:"ok"}))))),r.a.createElement("div",{className:"aboutus"},r.a.createElement("img",{src:"intro.jpg",alt:""}),r.a.createElement("div",{className:"intro"},"\u9879\u76ee\u7b80\u4ecb"),r.a.createElement("div",{className:"context"},r.a.createElement("p",null," \xa0\xa0\u672c\u9879\u76ee\u57fa\u4e8e\u533a\u5757\u94fe\u6280\u672f\uff0c\u4f7f\u7528\u6bd4\u7279\u5e01\u533a\u5757\u94fe\u8bb0\u5f55\u5b66\u5386\u8bc1\u4e66\u4fe1\u606f\u3002\u6709\u5229\u4e8e\u9ad8\u6821\u6570\u5b57\u5316\u7ba1\u7406\u8bc1\u4e66\u3001\u5b66\u751f\u5b9e\u65f6\u63d0\u4f9b\u5b66\u4e60\u51ed\u8bc1\u3001\u516c\u53f8\u9a8c\u8bc1\u5b66\u5386\u771f\u4f2a\uff0c\u4ece\u800c\u66f4\u597d\u7684\u7ef4\u62a4\u6559\u80b2\u79e9\u5e8f\u3002")),r.a.createElement("div",{className:"more"},r.a.createElement("a",{className:"menu-link",href:"http://127.0.0.1:8080/",target:"_self"},"more"))),r.a.createElement("div",{className:"show"},r.a.createElement("div",{className:"chanpinphoto"},r.a.createElement("p",{className:"step"},r.a.createElement("br",null),"1"),r.a.createElement("p",{className:"step"},r.a.createElement("br",null),"2"),r.a.createElement("p",{className:"step"},r.a.createElement("br",null),"3"),r.a.createElement("p",null,"\u901a\u8fc7\u8ba4\u8bc1\u7684\u5b66\u6821\u53ef\u4ee5\u9881\u53d1\u8bc1\u4e66,\u5e76\u5c06\u5176\u8bb0\u5f55\u4e8e\u533a\u5757\u94fe\u4e0a\uff0c\u5177\u6709\u5b89\u5168\u6027\u3001\u4e0d\u53ef\u7be1\u6539\u6027\u7b49\u4f18\u70b9\uff0c\u6b64\u5916,\u5b66\u6821\u8fd8\u53ef\u4ee5\u5bf9\u8bc1\u4e66\u8fdb\u884c\u64a4\u56de\u3002"),r.a.createElement("p",null,"\u83b7\u5f97\u8bc1\u4e66\u7684\u5b66\u751f\u53ef\u4ee5\u4e0d\u5fc5\u643a\u5e26\u7eb8\u8d28\u8bc1\u4e66,\u800c\u662f\u5728\u9700\u8981\u4f7f\u7528\u65f6\u51fa\u793a\u7535\u5b50\u7248\u8bc1\u660e\u5373\u53ef\u3002\u4e5f\u53ef\u4ee5\u901a\u8fc7\u8bc1\u4e66\u7684\u54c8\u5e0c\u503c\u5728IPFS\u5e73\u53f0\u4e0a\u83b7\u5f97\u8bc1\u4e66\u3002"),r.a.createElement("p",null,"\u4f01\u4e1a\u6216\u4efb\u4f55\u9700\u8981\u8ba4\u8bc1\u8bc1\u4e66\u6709\u6548\u6027\u7684\u7b2c\u4e09\u65b9\u90fd\u53ef\u4ee5\u5728\u672c\u7f51\u7ad9\u4e0a\u4f20\u5e76\u67e5\u8be2\u8bc1\u4e66\u7684\u6709\u6548\u6027\uff0c\u800c\u4e0d\u9700\u8981\u4f20\u7edf\u7684\u90ae\u4ef6\u3001\u7535\u8bdd\u7b49\u65b9\u5f0f\u3002"))),r.a.createElement("div",{className:"bottom"},r.a.createElement("ul",{className:"down"},r.a.createElement("li",null,"\xa9 All Rights Reserved "),r.a.createElement("li",null,"\u57fa\u4e8e\u533a\u5757\u94fe\u7684\u6559\u80b2\u4fe1\u606f\u9a8c\u8bc1\u7cfb\u7edf "),r.a.createElement("li",null,"\u65f6\u65fb \u6bd5\u4e1a\u8bbe\u8ba1"))))}}]),t}(n.Component),w=a(554),S=a(556),O=a(557),C=(a(544),a(545),function(e){function t(){return Object(l.a)(this,t),Object(u.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this.props.selected,t=this.props.path,a=this.props.item,n=this.props.select;return r.a.createElement("div",{className:"card ".concat(e?"border-primary":""),onClick:function(e){return n(e,a)}},r.a.createElement("img",{className:"card-img-top",src:"".concat(t).concat(a.id,".jpg"),alt:a.name}),r.a.createElement("div",{className:"card-body"},r.a.createElement("h4",{className:"card-title"},a.name),r.a.createElement("p",{className:"card-text"},a.superpower),r.a.createElement("button",{className:"btn btn-primary btn-block",disabled:e},e?"Selected":"Select")))}}]),t}(n.Component)),M=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(u.a)(this,Object(m.a)(t).call(this,e))).selectAnimal=a.selectAnimal.bind(Object(v.a)(a)),a.selectTerritory=a.selectTerritory.bind(Object(v.a)(a)),a.state={selectedAnimal:!1,selectedTerritory:!1},a.loadMe=a.loadMe.bind(Object(v.a)(a)),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentWillMount",value:function(){this.loadMe()}},{key:"loadMe",value:function(){this.props.me?this.setState({selectedAnimal:!0,selectedTerritory:!0}):this.setState({selectedAnimal:!1,selectedTerritory:!1})}},{key:"selectAnimal",value:function(e,t){e.preventDefault(),this.setState({selectedAnimal:!0}),this.props.saveMe(Object.assign({},this.props.me,{animal:t}))}},{key:"selectTerritory",value:function(e,t){e.preventDefault(),this.setState({selectedTerritory:!0}),this.props.saveMe(Object.assign({},this.props.me,{territory:t}))}},{key:"render",value:function(){var e=this,t=this.props.me,a=null,n=null;t&&(a=this.props.me.animal,n=this.props.me.territory);var s=this.state.selectedAnimal,i=this.state.selectedTerritory,c=s&&i,l=this.props.username;return r.a.createElement("div",{className:"EditMe container"},r.a.createElement("h2",null,"Your animal persona"),r.a.createElement("p",null,"You are the ruler of your kingdom! Pick your animal persona and its home!"),r.a.createElement("h3",null,"Select your animal"),r.a.createElement("div",{className:"row card-deck"},b.map(function(t,n){var s=a&&a.id===t.id;return r.a.createElement(C,{path:"/animals/",key:n,item:t,select:e.selectAnimal,selected:s})})),r.a.createElement("h3",{className:"select-territory"},"Select your territory"),r.a.createElement("div",{className:"card-deck"},g.map(function(t,a){var s=n&&n.id===t.id;return r.a.createElement(C,{path:"/territories/",key:a,item:t,select:e.selectTerritory,selected:s})})),r.a.createElement("div",{className:"container row"},r.a.createElement("div",{className:"col-lg-12 done"},r.a.createElement("p",null,r.a.createElement(h.a,{to:c?"/kingdom/".concat(l):"/me",className:"btn btn-primary"},"Done")))))}}]),t}(n.Component);function T(e){return JSON.parse(JSON.stringify(e))}function U(e,t,a){a.map(function(n,r){var s={decrypt:!1,app:n.app,username:n.username};return t.getFile(E,s).then(function(t){return t?(a[r]=Object.assign({},n,{missing:!1},JSON.parse(t)),e.setState({subjects:a}),a):(a[r]=Object.assign({},n,{missing:!0}),e.setState({subjects:a}),a)})})}var x=a(246),A=(a(546),function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(u.a)(this,Object(m.a)(t).call(this,e))).state={ruler:{animal:{},territory:{}},value:"",app:"".concat(e.protocol,"//").concat(e.realm),rulerUsername:e.ruler},a.userSession=new p.UserSession({appConfig:f}),a.addSubject=a.addSubject.bind(Object(v.a)(a)),a.removeSubject=a.removeSubject.bind(Object(v.a)(a)),a.handleChange=a.handleChange.bind(Object(v.a)(a)),a.loadKingdom=a.loadKingdom.bind(Object(v.a)(a)),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentWillMount",value:function(){var e=this.state.app,t=this.props.ruler;this.loadKingdom(t,e);var a=window.location.search;if(a){var n=a.split("=")[1];this.setState({value:n,clickAdd:!0})}(new FileReader).onloadend=function(e){"http://127.0.0.1:8080/certificate/jasmine.pdf".src=e.target.result}}},{key:"componentWillReceiveProps",value:function(e){var t=e.subjects;t&&(t.length!==this.state.subjects.length&&this.setState({subjects:T(t)}),U(this,this.userSession,t))}},{key:"handleChange",value:function(e){this.setState({value:e.target.value})}},{key:"loadKingdom",value:function(e,t){var a=this;(function(e,t,a){var n={decrypt:!1,username:t,app:a};return e.getFile(E,n).then(function(e){return e?JSON.parse(e):null})})(this.userSession,e,t).then(function(e){e&&a.setState({ruler:e})}),function(e,t,a){var n={decrypt:!1,username:t,app:a};return e.getFile(j,n).then(function(e){return e?JSON.parse(e):[]})}(this.userSession,e,t).then(function(e){a.setState({subjects:e}),U(a,a.userSession,e)})}},{key:"addSubject",value:function(e){e.preventDefault();var t=function(e){var t=e.split("/kingdom");return{app:t[0],username:t[1].split("/")[1]}}(this.state.value),a=T(this.state.subjects);this.setState({value:"",clickAdd:!1}),a.push(t),this.setState({subjects:a}),this.saveSubjects(a)}},{key:"removeSubject",value:function(e,t){e.preventDefault();var a=T(this.state.subjects);a.splice(t,1),this.setState({subjects:a}),this.saveSubjects(a)}},{key:"saveSubjects",value:function(e){var t=this;this.userSession.putFile(j,JSON.stringify(e),{encrypt:!1}).finally(function(){window.location.search&&window.history.pushState(null,"",window.location.href.split("?")[0]),U(t,t.userSession,e)})}},{key:"render",value:function(){var e=this.state.ruler.animal,t=this.state.rulerUsername,a=this.state.app,n=t;return r.a.createElement("div",{className:"Kingdom"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-lg-12 territory",style:{backgroundImage:"url('".concat(a,"/territories/campus.jpg')")}},r.a.createElement("img",{className:"rounded-circle",src:"".concat(a,"/animals/pku.jpg"),alt:e.name}))),r.a.createElement("div",{className:"row ruler"},r.a.createElement("div",{className:"col-lg-12"},r.a.createElement("h2",null,"Student ",t),r.a.createElement("p",null,r.a.createElement("a",{href:"".concat("https://explorer.blockstack.org","/name/").concat(t),target:"_blank",rel:"noopener noreferrer"},t)," has certificates:"),r.a.createElement("p",null,x.map(function(e,t){if(e.id===n)return r.a.createElement("form",{method:"get",action:"http://127.0.0.1:8080/certificates/"+n+".pdf"},r.a.createElement("p",null,"PKU_2020_Graduate_",e.name),r.a.createElement("button",{className:"btn btn-primary",type:"submit"},"\u4e0b\u8f7d"))})))))}}]),t}(n.Component)),K=(a(547),function(e){function t(){return Object(l.a)(this,t),Object(u.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this.props.username;return r.a.createElement("nav",{className:"navbar navbar-expand-md navbar-dark bg-blue fixed-top"},r.a.createElement(h.a,{className:"navbar-brand",to:"/"},"PKU Cert Centre"),r.a.createElement("div",{className:"collapse navbar-collapse",id:"navbarsExampleDefault"},r.a.createElement("ul",{className:"navbar-nav mr-auto"},r.a.createElement("li",{className:"nav-item"},r.a.createElement(h.a,{className:"nav-link",to:"/"},"\u7f51\u7ad9\u9996\u9875")),r.a.createElement("li",{className:"nav-item"},r.a.createElement(h.a,{className:"nav-link",to:"/"},"\u9a8c\u8bc1\u8bc1\u4e66")),r.a.createElement("li",{className:"nav-item"},r.a.createElement(h.a,{className:"nav-link",to:"/kingdom/".concat(e)},"\u4e2a\u4eba\u4e3b\u9875")),r.a.createElement("li",{className:"nav-item"},r.a.createElement(h.a,{className:"nav-link",to:"/"},"\u5173\u4e8e\u6211\u4eec")))),r.a.createElement("ul",{className:"navbar-nav mr-auto"},r.a.createElement("li",{className:"nav-item"},r.a.createElement(h.a,{className:"nav-link",to:"/"},e))),r.a.createElement("button",{className:"btn btn-primary",onClick:this.props.signOut.bind(this)},"Sign out"))}}]),t}(n.Component)),I=(a(548),function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(u.a)(this,Object(m.a)(t).call(this,e))).userSession=new p.UserSession({appConfig:f}),a.state={me:{},savingMe:!1,savingKingdown:!1,redirectToMe:!1},a.loadMe=a.loadMe.bind(Object(v.a)(a)),a.saveMe=a.saveMe.bind(Object(v.a)(a)),a.signOut=a.signOut.bind(Object(v.a)(a)),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentWillMount",value:function(){this.loadMe()}},{key:"loadMe",value:function(){var e=this;this.userSession.getFile(E,{decrypt:!1}).then(function(t){if(t){var a=JSON.parse(t);e.setState({me:a,redirectToMe:!1})}else{e.setState({me:null,redirectToMe:!0})}})}},{key:"saveMe",value:function(e){var t=this;this.setState({me:e,savingMe:!0});this.userSession.putFile(E,JSON.stringify(e),{encrypt:!1}).finally(function(){t.setState({savingMe:!1,redirectToMe:!1})})}},{key:"signOut",value:function(e){e.preventDefault(),this.userSession.signUserOut(),window.location="/"}},{key:"render",value:function(){var e=this,t=this.userSession.loadUserData().username,a=this.state.me;return this.state.redirectToMe&&"/me"!==window.location.pathname?r.a.createElement(w.a,{to:"/me"}):"/"===window.location.pathname?r.a.createElement(w.a,{to:"/kingdom/".concat(t)}):r.a.createElement("div",{className:"SignedIn"},r.a.createElement(K,{username:t,signOut:this.signOut}),r.a.createElement(S.a,null,r.a.createElement(O.a,{path:"/me",render:function(n){return r.a.createElement(M,Object.assign({me:a,saveMe:e.saveMe,username:t},n))}}),r.a.createElement(O.a,{path:"/kingdom/".concat(t),render:function(e){return r.a.createElement(A,Object.assign({myKingdom:!0,protocol:window.location.protocol,ruler:t,currentUsername:t,realm:window.location.origin.split("//")[1]},e))}}),r.a.createElement(O.a,{path:"/kingdom/:protocol/:realm/:ruler",render:function(e){return r.a.createElement(A,Object.assign({myKingdom:!1,protocol:e.match.params.protocol,realm:e.match.params.realm,ruler:e.match.params.ruler,currentUsername:t},e))}})))}}]),t}(n.Component)),D=function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(u.a)(this,Object(m.a)(t).call(this))).userSession=new p.UserSession,e}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentWillMount",value:function(){var e=this.userSession;!e.isUserSignedIn()&&e.isSignInPending()&&e.handlePendingSignIn().then(function(e){if(!e.username)throw new Error("This app requires a username.");window.location="/kingdom/".concat(e.username)})}},{key:"render",value:function(){return r.a.createElement("main",{role:"main"},this.userSession.isUserSignedIn()?r.a.createElement(I,null):r.a.createElement(N,null))}}]),t}(n.Component),J=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function W(e){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}}).catch(function(e){console.error("Error during service worker registration:",e)})}a(550);i.a.render(r.a.createElement(c.a,null,r.a.createElement(D,null)),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL("",window.location).origin!==window.location.origin)return;window.addEventListener("load",function(){var e="".concat("","/service-worker.js");J?(function(e){fetch(e).then(function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):W(e)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")})):W(e)})}}()}},[[247,1,2]]]);
//# sourceMappingURL=main.7265cd34.chunk.js.map